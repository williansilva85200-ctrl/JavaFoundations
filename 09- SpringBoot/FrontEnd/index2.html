<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Consulta de Roupas</title>

    <!-- Bootstrap 5 -->
    <link 
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" 
        rel="stylesheet"
    >
</head>
<body class="bg-light">

<div class="container mt-5">

    <h2 class="mb-4 text-center">Consulta de Roupas</h2>

    <div class="d-grid gap-2 col-4 mx-auto mb-3">
        <button class="btn btn-primary" onclick="buscarRoupas()">
            Buscar Produtos
        </button>
    </div>

    <div class="table-responsive">
        <table class="table table-bordered table-striped align-middle text-center">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Tipo</th>
                    <th>Marca</th>
                    <th>Tamanho</th>
                    <th>Quantidade</th>
                    <th>Preço (R$)</th>
                    <th>Total (R$)</th>
                </tr>
            </thead>
            <tbody id="tabelaRoupas">
                <!-- Dados da API -->
            </tbody>
        </table>
    </div>

    <div id="totalGeral" class="fw-bold fs-5 mt-3"></div>

    <div id="mensagem" class="mt-3 fw-bold"></div>

</div>

<script>
    function buscarRoupas() {
        const endpoint = "https://localhost:8080/roupas";

        const tabela = document.getElementById("tabelaRoupas");
        const mensagem = document.getElementById("mensagem");
        const totalGeralDiv = document.getElementById("totalGeral");

        // Limpa conteúdos anteriores
        tabela.innerHTML = "";
        mensagem.innerHTML = "";
        totalGeralDiv.innerHTML = "";

        fetch(endpoint)
            .then(response => {
                if (!response.ok) {
                    throw new Error("Erro ao acessar a API");
                }
                return response.json();
            })
            .then(dados => {

                if (dados.length === 0) {
                    mensagem.innerHTML = "Nenhum produto encontrado";
                    mensagem.className = "text-danger";
                    return;
                }

                let totalGeral = 0;

                dados.forEach(roupa => {
                    const totalProduto = roupa.quantidade * roupa.preco;
                    totalGeral += totalProduto;

                    const linha = document.createElement("tr");

                    linha.innerHTML = `
                        <td>${roupa.id}</td>
                        <td>${roupa.tipo}</td>
                        <td>${roupa.marca}</td>
                        <td>${roupa.tamanho}</td>
                        <td>${roupa.quantidade}</td>
                        <td>${roupa.preco.toFixed(2)}</td>
                        <td>${totalProduto.toFixed(2)}</td>
                    `;

                    tabela.appendChild(linha);
                });

                totalGeralDiv.innerHTML = `Valor Total Geral: R$ ${totalGeral.toFixed(2)}`;
                mensagem.innerHTML = "Produtos carregados com sucesso";
                mensagem.className = "text-success";

            })
            .catch(error => {
                mensagem.innerHTML = "Erro ao buscar produtos";
                mensagem.className = "text-danger";
                console.error(error);
            });
    }
</script>

</body>
</html>
